#!/bin/bash

# Nexus Repository Manager details
NEXUS_URL="https://nexus.app.syfbank.com:8443"
CREDENTIALS="username:password"

# Output file
OUTPUT_FILE="nexus_repositories_$(date +%Y%m%d_%H%M%S).txt"

# Function to list repositories
list_repositories() {
  echo "Fetching list of repositories from Nexus..."

  response=$(curl -u $CREDENTIALS -X GET "$NEXUS_URL/service/rest/v1/repositories" -s)
  http_status=$(echo "$response" | jq -r '. | length')  # Check if JSON is returned

  if [ "$http_status" -ge 1 ]; then
    echo "List of Repositories:" > $OUTPUT_FILE
    echo "$response" | jq -r '.[] | "\(.name) (\(.format))"' >> $OUTPUT_FILE
    echo "Repositories list saved to $OUTPUT_FILE"
  else
    echo "Failed to fetch repositories. Check your Nexus URL, credentials, and try again."
  fi
}

# Call the function to list repositories
list_repositories
