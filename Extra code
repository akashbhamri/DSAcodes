To check the number of repositories and users in Bitbucket using Splunk logs, follow these steps:


---

Step 1: Counting Repositories in Splunk Logs

Look for repository-related events using the following Splunk search query:

Splunk Query for Repositories:

index=<your_index> application-data/bitbucket/log "repositories/"

Steps:

1. Run the above query.


2. In the results, look for lines like this:

/shared/data/repositories/<repo_id>


3. To count unique repositories, modify the query:



Query to Count Unique Repository IDs:

index=<your_index> application-data/bitbucket/log "repositories/" | rex field=_raw "repositories\/(?<repo_id>\d+)" | stats dc(repo_id) as Total_Repositories


---

Step 2: Counting Users in Splunk Logs

Look for user authentication or activity-related events.

Splunk Query for Users:

index=<your_index> application-data/bitbucket/log "authenticated"

Steps:

1. Run the query to see authenticated users.


2. Modify the query to count unique users:



Query to Count Unique Users:

index=<your_index> application-data/bitbucket/log "authenticated" | rex field=_raw "authenticated (?<username>\S+)" | stats dc(username) as Total_Users


---

Step 3: Combined Query to Get Both Repositories and Users

You can combine both queries into one:

index=<your_index> application-data/bitbucket/log | rex field=_raw "repositories\/(?<repo_id>\d+)" | rex field=_raw "authenticated (?<username>\S+)" | stats dc(repo_id) as Total_Repositories, dc(username) as Total_Users


---

Explanation:

rex: Extracts repository IDs and usernames from log lines.

stats dc(): Counts distinct values of repo_id and username.



---

Would you like me to help fine-tune the query further based on your logs?

