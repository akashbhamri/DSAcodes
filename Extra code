Initial Investigation

1. User Reports: Multiple users reported that Bitbucket was inaccessible starting around 7:00 PM IST (8:30 AM EST).


2. Immediate Checks:

Verified application health through New Relic dashboards.

Checked Splunk logs for errors related to database or connection failures.

Observed high traffic on Bitbucket during the time frame (7:00 PM – 9:00 PM IST).





---

New Relic Investigation

Dashboard Observations:

1. Increased Response Time:

Spikes in response time between 7:00 PM – 9:00 PM IST (8:30 AM – 10:30 AM EST) indicating potential database lock or connection issues.



2. Error Rate:

Error rates for database transactions significantly increased during the affected window.

Specific errors related to DATABSECHANGELOGLOCK were observed.



3. Database Throughput:

Sudden drop in successful database operations, correlating with the time of Bitbucket unavailability.





---

Splunk Logs Analysis

Log Queries:

1. Application Logs (atlassian-bitbucket.log):

index=bitbucket_logs "DATABSECHANGELOGLOCK" OR "Could not acquire change log lock"

Found multiple LiquibaseException and Could not acquire change log lock errors.

First occurrence was at 7:10 PM IST (8:40 AM EST).



2. Database Logs:

index=db_logs "UPDATE DATABSECHANGELOGLOCK" OR "locked"

Detected SQL errors related to row lock conflicts.

Lock was active until it was manually released at 02:19 AM IST (03:49 PM EST).




Key Findings from Splunk:

Error Messages: Repeated occurrences of Could not acquire change log lock.

No Successful Unlock: No automatic resolution until the manual update was applied by the SQL DBA team.



---

Next Steps:

1. Detailed Analysis: Continue working with the platform team and Atlassian to analyze the logs further.


2. Monitor Lock Events: Set up Splunk alerts for DATABSECHANGELOGLOCK to catch prolonged locks.


3. High Traffic Impact: Investigate if the high traffic caused contention leading to this lock.




---

Let me know if you want the Splunk queries or New Relic dashboards detailed further!

